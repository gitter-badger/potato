branches:
  only:
    - master

language: cpp

compiler:
  - gcc

before_install:
  - sudo add-apt-repository --yes ppa:ubuntu-sdk-team/ppa
  - sudo apt-get update
  - sudo apt-get install cppcheck valgrind libgles1-mesa-dev qt5-default
  - sudo pip install cpp-coveralls

before_script:
  - cppcheck code/editor code/potato code/test -I code/editor/ -I code/potato/ -I code/potato/inc -I code/potato/src -I code/potato/src/engine -I code/test/ --quiet --error-exitcode=1
  - git submodule init
  - git submodule update
  - cd code/external/
  - cd tinycc/
  - ./configure
  - cd ../
  - cd libpng/
  - cmake ./
  - cd ../
  - cd ../../
  - mkdir -p out
  - mkdir -p out/bin
  - mkdir -p out/lib
  - mkdir -p out/make
  - cd out/make
  - cmake -D C4G_BUILD_EDITOR=TRUE -D CMAKE_BUILD_TYPE=Release -D QT_SDK_PATH=/usr -D USE_COVERALLS=TRUE ../../build/cmake/
  - cd ../../

script:
  - cd out/make/
  - make
  - cd ../../

after_success:
  - ./out/bin/t001
  - coveralls --exclude build/ --exclude data/ --exclude doc/ --exclude code/external/ --exclude out/make/external/ --exclude out/make/CMakeFiles/ --gcov-options '\-lp'
#  - valgrind --leak-check=yes out/bin/test

notifications:
  email:
    - alex@alexchi.me
  on_success: change
  on_failure: always

